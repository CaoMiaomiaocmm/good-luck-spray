<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¥½è¿å–·é›¾ âœ¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px;
        }
        @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        .container { text-align: center; z-index: 10; position: relative; max-width: 1200px; width: 100%; }
        .fairy { font-size: 120px; animation: float 3s ease-in-out infinite; cursor: pointer; transition: transform .3s; user-select: none; }
        .fairy:hover { transform: scale(1.1) }
        .fairy.spraying { animation: spray .5s ease-out }
        @keyframes float { 0%,100%{transform: translateY(0)} 50%{transform: translateY(-20px)} }
        @keyframes spray { 0%{transform:scale(1) rotate(0)} 50%{transform:scale(1.2) rotate(-10deg)} 100%{transform:scale(1) rotate(0)} }
        .spray-button { margin-top:30px; padding:15px 40px; font-size:20px; background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%); border:none; border-radius:50px; color:#fff; cursor:pointer; box-shadow:0 10px 30px rgba(0,0,0,.3); transition:all .3s; font-weight:bold; }
        .spray-button:hover { transform: translateY(-3px); box-shadow:0 15px 40px rgba(0,0,0,.4) }
        .blessing-text { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:32px; color:#fff; text-shadow:0 0 20px rgba(255,255,255,.8); opacity:0; pointer-events:none; font-weight:bold; white-space:nowrap; z-index:100 }
        .blessing-text.show { animation: blessAppear 3s ease-out forwards }
        @keyframes blessAppear { 0%{opacity:0; transform:translate(-50%,-50%) scale(.5)} 20%{opacity:1; transform:translate(-50%,-50%) scale(1.2)} 80%{opacity:1; transform:translate(-50%,-50%) scale(1)} 100%{opacity:0; transform:translate(-50%,-50%) scale(1)} }
        .particle { position:fixed; pointer-events:none; font-size:24px; animation: particleFall 2s ease-out forwards; z-index:99 }
        @keyframes particleFall { 0%{opacity:1; transform:translate(0,0) rotate(0) scale(0)} 50%{opacity:1; transform:translate(var(--tx),var(--ty)) rotate(360deg) scale(1)} 100%{opacity:0; transform:translate(calc(var(--tx)*1.5), calc(var(--ty)*2)) rotate(720deg) scale(.5)} }
        .flash-overlay { position:fixed; inset:0; background: radial-gradient(circle, rgba(255,255,255,.8) 0%, rgba(255,255,255,0) 70%); opacity:0; pointer-events:none; z-index:50 }
        .flash-overlay.active { animation: flash .5s ease-out }
        @keyframes flash { 0%{opacity:0} 50%{opacity:1} 100%{opacity:0} }
        .title { color:#fff; font-size:48px; text-shadow:0 0 20px rgba(255,255,255,.5); margin-bottom:20px; font-weight:bold }
        .features-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:20px; margin-top:40px; max-width:1200px }
        .feature-card { background:rgba(255,255,255,.15); backdrop-filter: blur(10px); border-radius:20px; padding:25px; border:2px solid rgba(255,255,255,.3); cursor:pointer; transition:all .3s; text-align:center }
        .feature-card:hover { transform: translateY(-5px); background:rgba(255,255,255,.25); box-shadow:0 10px 30px rgba(0,0,0,.3) }
        .feature-icon { font-size:60px; margin-bottom:15px }
        .feature-title { color:#fff; font-size:22px; font-weight:bold; margin-bottom:10px }
        .feature-desc { color:rgba(255,255,255,.9); font-size:14px }
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:200; justify-content:center; align-items:center; padding:20px }
        .modal.active { display:flex }
        .modal-content { background: linear-gradient(135deg,#667eea 0%, #764ba2 100%); border-radius:30px; padding:40px; max-width:500px; width:100%; border:3px solid rgba(255,255,255,.4); box-shadow:0 20px 60px rgba(0,0,0,.5); text-align:center; position:relative; animation: modalAppear .3s ease-out }
        @keyframes modalAppear { from{opacity:0; transform:scale(.8)} to{opacity:1; transform:scale(1)} }
        .close-modal { position:absolute; top:15px; right:20px; font-size:30px; color:#fff; cursor:pointer; line-height:1 }
        .modal-title { color:#fff; font-size:32px; margin-bottom:30px; font-weight:bold }
        .fortune-card { background:rgba(255,255,255,.2); backdrop-filter: blur(10px); border-radius:20px; padding:30px; margin:20px 0; border:2px solid rgba(255,255,255,.3) }
        .fortune-result { font-size:60px; margin-bottom:20px }
        .fortune-text { color:#fff; font-size:24px; font-weight:bold; margin-bottom:15px }
        .fortune-detail { color:rgba(255,255,255,.9); font-size:16px; line-height:1.6 }
        .draw-button { padding:15px 40px; font-size:18px; background:linear-gradient(135deg,#f5576c 0%, #f093fb 100%); border:none; border-radius:50px; color:#fff; cursor:pointer; font-weight:bold; transition:all .3s; box-shadow:0 5px 20px rgba(0,0,0,.3) }
        .draw-button:hover { transform: scale(1.05) }
        .lucky-number-display { display:flex; justify-content:center; gap:15px; margin:30px 0; flex-wrap:wrap }
        .lucky-number { width:60px; height:60px; background:linear-gradient(135deg,#f093fb 0%, #f5576c 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:24px; font-weight:bold; box-shadow:0 5px 15px rgba(0,0,0,.3); animation: numberPop .5s ease-out }
        @keyframes numberPop { 0%{transform:scale(0) rotate(0)} 50%{transform:scale(1.2) rotate(180deg)} 100%{transform:scale(1) rotate(360deg)} }
        .coins-container { display:flex; justify-content:center; gap:20px; margin:30px 0; flex-wrap:wrap }
        .coin { width:80px; height:80px; background:linear-gradient(135deg,#ffd700 0%, #ffed4e 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:40px; cursor:pointer; transition:all .3s; box-shadow:0 5px 20px rgba(255,215,0,.5); border:3px solid #fff }
        .coin:hover { transform: scale(1.1) rotate(10deg) }
        .coin.flipping { animation: coinFlip 1s ease-in-out }
        @keyframes coinFlip { 0%{transform: rotateY(0)} 100%{transform: rotateY(1080deg)} }
        .energy-bar { width:100%; height:30px; background:rgba(255,255,255,.2); border-radius:15px; overflow:hidden; margin:20px 0; border:2px solid rgba(255,255,255,.3) }
        .energy-fill { height:100%; background:linear-gradient(90deg,#4facfe 0%, #00f2fe 100%); transition:width .5s ease; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold }
        .tarot-cards { display:flex; justify-content:center; gap:20px; margin:30px 0; flex-wrap:wrap }
        .tarot-card { width:100px; height:160px; background:linear-gradient(135deg,#667eea 0%, #764ba2 100%); border-radius:10px; cursor:pointer; transition:all .3s; display:flex; align-items:center; justify-content:center; font-size:50px; border:3px solid rgba(255,255,255,.5); box-shadow:0 5px 20px rgba(0,0,0,.3); position:relative }
        .tarot-card:hover { transform: translateY(-10px) }
        .tarot-card.flipped { animation: cardFlip .6s ease-in-out }
        @keyframes cardFlip { 0%,100%{transform: rotateY(0)} 50%{transform: rotateY(180deg)} }
        .stats-container { background:rgba(255,255,255,.15); backdrop-filter: blur(10px); border-radius:20px; padding:20px; margin-top:30px; border:2px solid rgba(255,255,255,.3) }
        .stat-item { display:flex; justify-content:space-between; color:#fff; margin:10px 0; font-size:18px }
        .stat-value { font-weight:bold; color:#ffd700 }
        footer { margin-top: 28px; color: rgba(255,255,255,.9); font-size: 14px }
        @media (max-width:768px){ .fairy{font-size:80px} .title{font-size:36px} .spray-button{font-size:18px; padding:12px 30px} .blessing-text{font-size:20px; white-space:normal; max-width:90%} .features-grid{grid-template-columns:1fr} .modal-content{padding:30px 20px} .fortune-result{font-size:50px} .fortune-text{font-size:20px} }
    </style>
</head>
<body>
    <div class="flash-overlay" id="flashOverlay"></div>
    <div class="container">
        <h1 class="title">âœ¨ å¥½è¿å–·é›¾ âœ¨</h1>
        <div class="fairy" id="fairy">ğŸ§šâ€â™€ï¸</div>
        <button class="spray-button" id="sprayBtn">å–·æ´’å¥½è¿ âœ¨</button>

        <div class="features-grid">
            <div class="feature-card" onclick="openFortuneModal()">
                <div class="feature-icon">ğŸ”®</div>
                <div class="feature-title">ä»Šæ—¥è¿åŠ¿</div>
                <div class="feature-desc">æŠ½å–ä»Šå¤©çš„è¿åŠ¿ç­¾ï¼Œçœ‹çœ‹è¿æ°”å¦‚ä½•</div>
            </div>
            <div class="feature-card" onclick="openLuckyNumberModal()">
                <div class="feature-icon">ğŸ°</div>
                <div class="feature-title">å¹¸è¿æ•°å­—</div>
                <div class="feature-desc">ç”Ÿæˆä½ çš„ä¸“å±å¹¸è¿æ•°å­—</div>
            </div>
            <div class="feature-card" onclick="openCoinModal()">
                <div class="feature-icon">ğŸª™</div>
                <div class="feature-title">æŠ›ç¡¬å¸å†³ç­–</div>
                <div class="feature-desc">è®©å‘½è¿å¸®ä½ åšé€‰æ‹©</div>
            </div>
            <div class="feature-card" onclick="openTarotModal()">
                <div class="feature-icon">ğŸƒ</div>
                <div class="feature-title">å¡”ç½—å åœ</div>
                <div class="feature-desc">æŠ½å–å¡”ç½—ç‰ŒæŒ‡å¼•æ–¹å‘</div>
            </div>
            <div class="feature-card" onclick="openEnergyModal()">
                <div class="feature-icon">âš¡</div>
                <div class="feature-title">èƒ½é‡å……èƒ½</div>
                <div class="feature-desc">ä¸ºè‡ªå·±æ³¨å…¥æ­£èƒ½é‡</div>
            </div>
            <div class="feature-card" onclick="openWishModal()">
                <div class="feature-icon">ğŸŒ </div>
                <div class="feature-title">è®¸æ„¿æ± </div>
                <div class="feature-desc">å†™ä¸‹æ„¿æœ›ï¼Œè®©å®ƒæˆçœŸ</div>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-item"><span>ä»Šæ—¥å¥½è¿å€¼:</span><span class="stat-value" id="luckScore">0</span></div>
            <div class="stat-item"><span>ç´¯è®¡å–·æ´’æ¬¡æ•°:</span><span class="stat-value" id="sprayCount">0</span></div>
            <div class="stat-item"><span>æ”¶é›†çš„ç¥ç¦:</span><span class="stat-value" id="blessingCount">0</span></div>
        </div>
        <footer>å°è´´å£«ï¼šæ·»åŠ åˆ°ä¸»å±å¹•ï¼Œéšæ‰‹å–·ä¸€å–·ï¼Œå¿ƒæƒ…æ›´å¥½ï½</footer>
    </div>

    <div class="blessing-text" id="blessingText"></div>

    <!-- è¿åŠ¿æŠ½ç­¾Modal -->
    <div class="modal" id="fortuneModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('fortuneModal')">Ã—</span>
            <div class="modal-title">ğŸ”® ä»Šæ—¥è¿åŠ¿</div>
            <div class="fortune-card" id="fortuneCard" style="display:none;">
                <div class="fortune-result" id="fortuneEmoji"></div>
                <div class="fortune-text" id="fortuneLevel"></div>
                <div class="fortune-detail" id="fortuneDetail"></div>
            </div>
            <button class="draw-button" onclick="drawFortune()">æŠ½å–è¿åŠ¿</button>
        </div>
    </div>

    <!-- å¹¸è¿æ•°å­—Modal -->
    <div class="modal" id="luckyNumberModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('luckyNumberModal')">Ã—</span>
            <div class="modal-title">ğŸ° å¹¸è¿æ•°å­—</div>
            <div class="lucky-number-display" id="luckyNumbers"></div>
            <button class="draw-button" onclick="generateLuckyNumbers()">ç”Ÿæˆå¹¸è¿æ•°å­—</button>
        </div>
    </div>

    <!-- æŠ›ç¡¬å¸Modal -->
    <div class="modal" id="coinModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('coinModal')">Ã—</span>
            <div class="modal-title">ğŸª™ æŠ›ç¡¬å¸å†³ç­–</div>
            <div class="coins-container"><div class="coin" onclick="flipCoin(this)">ğŸª™</div></div>
            <div class="fortune-text" id="coinResult" style="margin-top:20px;"></div>
            <div class="fortune-detail">ç‚¹å‡»ç¡¬å¸è¿›è¡ŒæŠ›æ·</div>
        </div>
    </div>

    <!-- å¡”ç½—ç‰ŒModal -->
    <div class="modal" id="tarotModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('tarotModal')">Ã—</span>
            <div class="modal-title">ğŸƒ å¡”ç½—å åœ</div>
            <div class="tarot-cards" id="tarotCards"></div>
            <div class="fortune-card" id="tarotResult" style="display:none; margin-top:20px;">
                <div class="fortune-result" id="tarotEmoji"></div>
                <div class="fortune-text" id="tarotTitle"></div>
                <div class="fortune-detail" id="tarotDetail"></div>
            </div>
        </div>
    </div>

    <!-- èƒ½é‡å……èƒ½Modal -->
    <div class="modal" id="energyModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('energyModal')">Ã—</span>
            <div class="modal-title">âš¡ èƒ½é‡å……èƒ½</div>
            <div class="energy-bar"><div class="energy-fill" id="energyFill" style="width:0%">0%</div></div>
            <button class="draw-button" onclick="chargeEnergy()">å¼€å§‹å……èƒ½</button>
            <div class="fortune-detail" style="margin-top:20px;">ç‚¹å‡»æŒ‰é’®ä¸ºè‡ªå·±æ³¨å…¥æ»¡æ»¡çš„æ­£èƒ½é‡ï¼</div>
        </div>
    </div>

    <!-- è®¸æ„¿æ± Modal -->
    <div class="modal" id="wishModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('wishModal')">Ã—</span>
            <div class="modal-title">ğŸŒ  è®¸æ„¿æ± </div>
            <textarea id="wishText" style="width:100%; height:120px; border-radius:15px; padding:15px; font-size:16px; border:2px solid rgba(255,255,255,.3); background:rgba(255,255,255,.2); color:#fff; resize:none;" placeholder="å†™ä¸‹ä½ çš„æ„¿æœ›..."></textarea>
            <button class="draw-button" onclick="makeWish()" style="margin-top:20px;">æŠ•å…¥è®¸æ„¿æ± </button>
            <div id="wishResult" style="margin-top:20px; color:#fff; font-size:18px;"></div>
        </div>
    </div>

    <script>
        // ===== æ•°æ®ä¸æ–‡æ¡ˆ =====
        const blessings = [
            "ä»Šå¤©ä¸€å®šä¼šè¶…çº§é¡ºåˆ©ï¼âœ¨","å¥½è¿æ­£åœ¨é è¿‘ä½  ğŸ’«","ä½ å€¼å¾—è¢«æ¸©æŸ”å¯¹å¾… ğŸ’•","å¹¸ç¦ä¼šåœ¨ä¸ç»æ„é—´é™ä¸´ ğŸŒ¸","æ‰€æœ‰ç¾å¥½éƒ½ä¼šå¦‚æœŸè€Œè‡³ ğŸŒˆ","ä»Šå¤©çš„ä½ é—ªé—ªå‘å…‰ â­","æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾… ğŸŒº","å¥½äº‹å³å°†å‘ç”Ÿ ğŸ‰","ä½ çš„ç¬‘å®¹ä¼šå¸¦æ¥å¥½è¿ ğŸ˜Š","ä»Šå¤©æ˜¯ç‰¹åˆ«å¹¸è¿çš„ä¸€å¤© ğŸ€","å¿ƒæƒ³äº‹æˆï¼Œä¸‡äº‹å¦‚æ„ ğŸŠ","ç¾å¥½çš„äº‹æƒ…æ­£åœ¨è·¯ä¸Š ğŸ¦‹","ä½ ä¼šæ”¶åˆ°æ„å¤–çš„æƒŠå–œ ğŸ","ä»Šå¤©é‡åˆ°çš„éƒ½æ˜¯å¥½äºº ğŸ’–","è¿æ°”çˆ†æ£šçš„ä¸€å¤©å¼€å§‹äº† ğŸŒŸ","æ‰€æœ‰éš¾é¢˜éƒ½ä¼šè¿åˆƒè€Œè§£ ğŸ’ª","ä»Šå¤©çš„ä½ è¶…çº§å¯çˆ± ğŸŒ·","å¥½è¿ä¼šçœ·é¡¾å–„è‰¯çš„ä½  ğŸ•Šï¸","å¹¸è¿å¥³ç¥åœ¨å¯¹ä½ å¾®ç¬‘ ğŸ˜‡","ä»Šå¤©åšä»€ä¹ˆéƒ½ä¼šå¾ˆé¡ºåˆ© ğŸˆ"
        ];
        const fortuneData = [
            { level:"å¤§å‰", emoji:"ğŸŒŸ", detail:"ä»Šå¤©è¿æ°”çˆ†æ£šï¼åšä»€ä¹ˆéƒ½ä¼šç‰¹åˆ«é¡ºåˆ©ï¼Œæ˜¯å®ç°æ„¿æœ›çš„å¥½æ—¥å­ï¼" },
            { level:"ä¸­å‰", emoji:"âœ¨", detail:"è¿åŠ¿ä¸é”™ï¼Œä¼šæœ‰å°æƒŠå–œå‡ºç°ï¼Œä¿æŒç§¯æå¿ƒæ€ä¼šæ›´å¥½ï¼" },
            { level:"å°å‰", emoji:"ğŸ€", detail:"å¹³ç¨³çš„ä¸€å¤©ï¼Œè¸å®åšäº‹ä¼šæœ‰å¥½ç»“æœï¼Œé€‚åˆç¨³æ­¥å‰è¿›ã€‚" },
            { level:"å‰", emoji:"ğŸ’«", detail:"æ•´ä½“é¡ºåˆ©ï¼Œå¶å°”ä¼šæœ‰å°æ³¢æŠ˜ï¼Œä½†æœ€ç»ˆéƒ½èƒ½åŒ–è§£ã€‚" },
            { level:"åŠå‰", emoji:"ğŸŒˆ", detail:"è¿åŠ¿å¹³å¹³ï¼Œä¿æŒå¹³å¸¸å¿ƒï¼Œä¸è¦å†’é™©å°è¯•æ–°äº‹ç‰©ã€‚" },
            { level:"æœ«å‰", emoji:"ğŸŒ¸", detail:"éœ€è¦å¤šåŠ å°å¿ƒï¼Œä½†åªè¦è°¨æ…è¡Œäº‹å°±æ²¡é—®é¢˜ã€‚" }
        ];
        const tarotData = [
            { name:"å¤ªé˜³", emoji:"â˜€ï¸", detail:"è±¡å¾æˆåŠŸã€å–œæ‚¦å’Œæ´»åŠ›ï¼Œä¸€åˆ‡éƒ½åœ¨å‘å¥½çš„æ–¹å‘å‘å±•ï¼" },
            { name:"æ˜Ÿæ˜Ÿ", emoji:"â­", detail:"å¸¦æ¥å¸Œæœ›å’Œçµæ„Ÿï¼Œä½ çš„æ„¿æœ›ä¼šé€æ­¥å®ç°ã€‚" },
            { name:"æœˆäº®", emoji:"ğŸŒ™", detail:"ä»£è¡¨ç›´è§‰ä¸æ¢¦æƒ³ï¼Œç›¸ä¿¡å†…å¿ƒçš„æ„Ÿå—ä¼šå¸¦ä½ èµ°å‘æ­£ç¡®é“è·¯ã€‚" },
            { name:"ä¸–ç•Œ", emoji:"ğŸŒ", detail:"å®Œæˆä¸åœ†æ»¡ï¼Œä½ å³å°†è¾¾æˆä¸€ä¸ªé‡è¦çš„ç›®æ ‡ï¼" },
            { name:"æ‹äºº", emoji:"ğŸ’•", detail:"è±¡å¾çˆ±æƒ…ä¸é€‰æ‹©ï¼Œä¼šæœ‰ç¾å¥½çš„æ„Ÿæƒ…ä½“éªŒã€‚" },
            { name:"åŠ›é‡", emoji:"ğŸ’ª", detail:"ä»£è¡¨å‹‡æ°”å’Œå†³å¿ƒï¼Œä½ æœ‰èƒ½åŠ›å…‹æœä»»ä½•å›°éš¾ï¼" }
        ];
        const particles = [ ['âœ¨','â­','ğŸ’«','ğŸŒŸ'], ['ğŸŒ¸','ğŸŒº','ğŸŒ·','ğŸŒ¹','ğŸµï¸'], ['ğŸ’–','ğŸ’•','ğŸ’—','ğŸ’'], ['ğŸ¦‹','ğŸ','ğŸŒˆ','â˜€ï¸'] ];

        // ===== å…¨å±€çŠ¶æ€ï¼ˆå¸¦æœ¬åœ°æŒä¹…åŒ–ï¼‰ =====
        let currentParticleSet = 0;
        const STATS_KEY = 'luckyAppStats_v1';
        let stats = { luckScore: 0, sprayCount: 0, blessingCount: 0, wishes: [] };
        function loadStats(){ try{ const s = JSON.parse(localStorage.getItem(STATS_KEY)); if(s){ stats = Object.assign(stats, s); } }catch(e){} updateStatsDisplay(); }
        function saveStats(){ localStorage.setItem(STATS_KEY, JSON.stringify(stats)); }
        function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }
        function updateStats(type, delta=0){
            if(type==='spray'){ stats.sprayCount += 1; stats.luckScore = clamp(stats.luckScore + 5, 0, 999); }
            if(type==='blessing'){ stats.blessingCount += 1; stats.luckScore = clamp(stats.luckScore + 2, 0, 999); }
            if(type==='luck'){ stats.luckScore = clamp(stats.luckScore + delta, 0, 999); }
            updateStatsDisplay(); saveStats();
        }
        function updateStatsDisplay(){
            document.getElementById('luckScore').textContent = stats.luckScore;
            document.getElementById('sprayCount').textContent = stats.sprayCount;
            document.getElementById('blessingCount').textContent = stats.blessingCount;
        }

        // ===== éŸ³æ•ˆä¸ç‰¹æ•ˆ =====
        function playSound(freq=800){
            const ctx = new (window.AudioContext||window.webkitAudioContext)();
            const osc = ctx.createOscillator(); const gain = ctx.createGain();
            osc.connect(gain); gain.connect(ctx.destination);
            osc.frequency.value = freq; osc.type = 'sine';
            gain.gain.setValueAtTime(0.3, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.5);
        }
        function createParticles(x,y){
            const set = particles[currentParticleSet]; const N = 30;
            for(let i=0;i<N;i++){
                const el = document.createElement('div'); el.className='particle'; el.textContent = set[Math.floor(Math.random()*set.length)];
                const ang = (Math.PI*2*i)/N; const dist = 100 + Math.random()*200; const tx = Math.cos(ang)*dist; const ty = Math.sin(ang)*dist;
                el.style.left = x+'px'; el.style.top = y+'px'; el.style.setProperty('--tx', tx+'px'); el.style.setProperty('--ty', ty+'px');
                document.body.appendChild(el); setTimeout(()=>el.remove(), 2000);
            }
            currentParticleSet = (currentParticleSet + 1) % particles.length;
        }
        function showBlessing(){
            const msg = blessings[Math.floor(Math.random()*blessings.length)];
            const box = document.getElementById('blessingText');
            box.textContent = msg; box.classList.remove('show'); void box.offsetWidth; box.classList.add('show');
            updateStats('blessing');
        }
        function triggerFlash(){ const f=document.getElementById('flashOverlay'); f.classList.remove('active'); void f.offsetWidth; f.classList.add('active'); }

        // ===== ä¸»æŒ‰é’®ï¼šå–·æ´’å¥½è¿ =====
        function sprayLuck(){
            const fairy = document.getElementById('fairy');
            fairy.classList.add('spraying'); setTimeout(()=>fairy.classList.remove('spraying'), 500);
            const r = fairy.getBoundingClientRect(); const x = r.left + r.width/2; const y = r.top + r.height/2;
            createParticles(x,y); playSound(); triggerFlash(); setTimeout(showBlessing, 300); updateStats('spray');
        }
        document.getElementById('sprayBtn').addEventListener('click', sprayLuck);
        document.getElementById('fairy').addEventListener('click', sprayLuck);

        // ===== é€šç”¨ Modal =====
        function openModal(id){ document.getElementById(id).classList.add('active'); }
        function closeModal(id){ document.getElementById(id).classList.remove('active'); }

        // ===== ä»Šæ—¥è¿åŠ¿ =====
        function openFortuneModal(){ openModal('fortuneModal'); document.getElementById('fortuneCard').style.display='none'; }
        function drawFortune(){
            const f = fortuneData[Math.floor(Math.random()*fortuneData.length)];
            document.getElementById('fortuneEmoji').textContent = f.emoji;
            document.getElementById('fortuneLevel').textContent = f.level;
            document.getElementById('fortuneDetail').textContent = f.detail;
            document.getElementById('fortuneCard').style.display='block';
            playSound(1000);
            updateStats('luck', 20);
        }

        // ===== å¹¸è¿æ•°å­— =====
        function openLuckyNumberModal(){ openModal('luckyNumberModal'); document.getElementById('luckyNumbers').innerHTML=''; }
        function generateLuckyNumbers(){
            const box = document.getElementById('luckyNumbers'); box.innerHTML='';
            const set = new Set();
            while(set.size < 6){ set.add(1 + Math.floor(Math.random()*49)); }
            const arr = Array.from(set).sort((a,b)=>a-b);
            arr.forEach(n=>{ const d=document.createElement('div'); d.className='lucky-number'; d.textContent=n; box.appendChild(d); });
            const bonus = Math.floor(arr.reduce((a,b)=>a+b,0) % 15); // å°å°åŠ æˆ
            updateStats('luck', 5 + bonus%6);
            playSound(1100);
        }

        // ===== æŠ›ç¡¬å¸ =====
        function openCoinModal(){ openModal('coinModal'); document.getElementById('coinResult').textContent=''; }
        function flipCoin(el){
            el.classList.add('flipping');
            setTimeout(()=>{
                el.classList.remove('flipping');
                const heads = Math.random() < 0.5;
                const text = heads ? 'æ­£é¢ï¼šå»åšï¼âœ…' : 'åé¢ï¼šå†æƒ³æƒ³ï½ ğŸ¤”';
                document.getElementById('coinResult').textContent = text;
                updateStats('luck', heads ? 10 : 5);
                playSound(heads?1200:700);
            }, 1000);
        }

        // ===== å¡”ç½—å åœ =====
        function openTarotModal(){
            openModal('tarotModal');
            const wrap = document.getElementById('tarotCards');
            wrap.innerHTML='';
            document.getElementById('tarotResult').style.display='none';
            // ç”Ÿæˆ 3 å¼ èƒŒé¢å¡
            for(let i=0;i<3;i++){
                const c = document.createElement('div'); c.className='tarot-card'; c.textContent='ğŸ”®';
                c.addEventListener('click', ()=> revealTarot(c, wrap));
                wrap.appendChild(c);
            }
        }
        function revealTarot(card, wrap){
            // ç¦æ­¢é‡å¤æŠ½
            Array.from(wrap.children).forEach(n=> n.style.pointerEvents='none');
            card.classList.add('flipped');
            setTimeout(()=>{
                const t = tarotData[Math.floor(Math.random()*tarotData.length)];
                const reversed = Math.random() < 0.5; // æ˜¯å¦é€†ä½
                document.getElementById('tarotEmoji').textContent = t.emoji;
                document.getElementById('tarotTitle').textContent = t.name + (reversed ? 'ï¼ˆé€†ä½ï¼‰' : '');
                document.getElementById('tarotDetail').textContent = reversed ? (`é€†ä½æç¤ºï¼šæ”¾æ…¢è„šæ­¥ï¼Œæ¢³ç†æƒ…ç»ªå†è¡ŒåŠ¨ã€‚â€” ${t.detail}`) : t.detail;
                document.getElementById('tarotResult').style.display='block';
                updateStats('luck', reversed ? 5 : 12);
                playSound(reversed?650:1050);
            }, 300);
        }

        // ===== èƒ½é‡å……èƒ½ =====
        function openEnergyModal(){ openModal('energyModal'); const f=document.getElementById('energyFill'); f.style.width='0%'; f.textContent='0%'; }
        function chargeEnergy(){
            const f = document.getElementById('energyFill');
            let cur = 0; const target = 70 + Math.floor(Math.random()*31); // 70~100
            const id = setInterval(()=>{
                cur = Math.min(target, cur + 5 + Math.floor(Math.random()*10));
                f.style.width = cur + '%'; f.textContent = cur + '%';
                if(cur >= target){ clearInterval(id); playSound(1200); updateStats('luck', Math.round(target/5)); }
            }, 120);
        }

        // ===== è®¸æ„¿æ±  =====
        function openWishModal(){ openModal('wishModal'); document.getElementById('wishText').value=''; document.getElementById('wishResult').textContent=''; }
        function makeWish(){
            const txt = document.getElementById('wishText').value.trim();
            const r = document.getElementById('wishResult');
            if(!txt){ r.textContent='å†™ç‚¹ä»€ä¹ˆå§ï½ï¼ˆæ„¿æœ›ä¸èƒ½ä¸ºç©ºï¼‰'; return; }
            stats.wishes.push({ text: txt, time: new Date().toISOString() }); saveStats();
            r.textContent = 'å·²æŠ•å…¥è®¸æ„¿æ± ï¼æ„¿æœ›æ­£åœ¨å®‡å®™æ’é˜Ÿå®ç°ä¸­ âœ¨';
            // è§¦å‘å–œæ‚¦ç²’å­
            const cx = window.innerWidth/2, cy = window.innerHeight/2; createParticles(cx, cy); playSound(1300);
            updateStats('luck', 15);
        }

        // ===== åˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', loadStats);
    </script>
</body>
</html>
