<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¥½è¿å–·é›¾ âœ¨</title>
  <style>
    :root{
      --txt:#ffffff; --sub:rgba(255,255,255,.9);
      --panel:rgba(255,255,255,.15); --panel-strong:rgba(255,255,255,.25);
      --border:rgba(255,255,255,.3);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Arial',sans-serif;overflow-x:hidden;min-height:100vh;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%);
      background-size:400% 400%;animation:gradientShift 15s ease infinite;
      display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;color:var(--txt);
    }
    @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .container{ text-align:center; max-width:1200px; width:100% }
    .title{ font-size:48px; text-shadow:0 0 20px rgba(255,255,255,.5); margin-bottom:10px; font-weight:bold }
    .subtitle{ opacity:.95; margin-bottom:16px }
    .fairy{ font-size:120px; animation:float 3s ease-in-out infinite; cursor:pointer; transition:transform .3s; user-select:none }
    .fairy:hover{ transform:scale(1.1) }
    .fairy.spraying{ animation:spray .5s ease-out }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    @keyframes spray{0%{transform:scale(1) rotate(0)}50%{transform:scale(1.2) rotate(-10deg)}100%{transform:scale(1) rotate(0)}}
    .spray-button,.btn{
      margin-top:12px; padding:12px 26px; font-size:16px; background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);
      border:none;border-radius:50px;color:#fff;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,.3);transition:all .3s;font-weight:bold;
    }
    .spray-button:hover,.btn:hover{ transform:translateY(-2px); box-shadow:0 15px 40px rgba(0,0,0,.4) }

    .blessing-text{
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      font-size:32px; color:#fff; text-shadow:0 0 20px rgba(255,255,255,.8);
      opacity:0; pointer-events:none; font-weight:bold; white-space:nowrap; z-index:100
    }
    .blessing-text.show{ animation:blessAppear 3s ease-out forwards }
    @keyframes blessAppear{0%{opacity:0;transform:translate(-50%,-50%) scale(.5)}20%{opacity:1;transform:translate(-50%,-50%) scale(1.2)}80%{opacity:1;transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-50%) scale(1)}}

    .particle{ position:fixed; pointer-events:none; font-size:24px; animation:particleFly 2s ease-out forwards; z-index:99 }
    @keyframes particleFly{0%{opacity:1; transform:translate(0,0) scale(0)}50%{opacity:1; transform:translate(var(--tx),var(--ty)) scale(1)}100%{opacity:0; transform:translate(calc(var(--tx)*1.5), calc(var(--ty)*2)) scale(.5)}}

    .features-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:16px; margin-top:24px; max-width:1200px }
    .feature-card{ background:var(--panel); backdrop-filter:blur(10px); border-radius:16px; padding:18px; border:2px solid var(--border); cursor:pointer; transition:all .25s; text-align:center }
    .feature-card:hover{ transform:translateY(-5px); background:var(--panel-strong); box-shadow:0 10px 30px rgba(0,0,0,.25) }
    .feature-icon{ font-size:48px; margin-bottom:10px }
    .feature-title{ font-size:18px; font-weight:bold; margin-bottom:6px }
    .feature-desc{ color:var(--sub); font-size:13px }

    .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:200; justify-content:center; align-items:center; padding:20px }
    .modal.active{ display:flex }
    .modal-content{
      background:linear-gradient(135deg,#667eea 0%, #764ba2 100%);
      border-radius:24px; padding:28px; max-width:560px; width:100%;
      border:3px solid rgba(255,255,255,.4); box-shadow:0 20px 60px rgba(0,0,0,.5);
      text-align:center; position:relative; animation:modalAppear .25s ease-out
    }
    @keyframes modalAppear{from{opacity:0; transform:scale(.9)} to{opacity:1; transform:scale(1)}}
    .close-modal{ position:absolute; top:12px; right:16px; font-size:26px; color:#fff; cursor:pointer; line-height:1 }
    .modal-title{ font-size:24px; margin-bottom:16px; font-weight:bold }
    .fortune-card{ background:rgba(255,255,255,.2); backdrop-filter:blur(10px); border-radius:16px; padding:22px; margin:14px 0; border:2px solid rgba(255,255,255,.3) }
    .fortune-result{ font-size:52px; margin-bottom:14px }
    .fortune-text{ font-size:20px; font-weight:bold; margin-bottom:10px }
    .fortune-detail{ color:#fff; font-size:15px; line-height:1.6 }

    .lucky-number-display{ display:flex; justify-content:center; gap:12px; margin:18px 0; flex-wrap:wrap }
    .lucky-number{ width:56px; height:56px; background:linear-gradient(135deg,#f093fb 0%, #f5576c 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:22px; font-weight:bold; box-shadow:0 5px 15px rgba(0,0,0,.3); animation:numberPop .5s ease-out }
    @keyframes numberPop{0%{transform:scale(0) rotate(0)}50%{transform:scale(1.2) rotate(180deg)}100%{transform:scale(1) rotate(360deg)}}

    .coins-container{ display:flex; justify-content:center; gap:16px; margin:16px 0; flex-wrap:wrap }
    .coin{ width:80px; height:80px; background:linear-gradient(135deg,#ffd700 0%, #ffed4e 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:40px; cursor:pointer; transition:all .3s; box-shadow:0 5px 20px rgba(255,215,0,.5); border:3px solid #fff }
    .coin:hover{ transform:scale(1.1) rotate(10deg) }
    .coin.flipping{ animation:coinFlip 1s ease-in-out }
    @keyframes coinFlip{0%{transform:rotateY(0)}100%{transform:rotateY(1080deg)}}

    .energy-bar{ width:100%; height:28px; background:rgba(255,255,255,.2); border-radius:14px; overflow:hidden; margin:16px 0; border:2px solid rgba(255,255,255,.3) }
    .energy-fill{ height:100%; background:linear-gradient(90deg,#4facfe 0%, #00f2fe 100%); transition:width .5s ease; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold }

    .tarot-cards{ display:flex; justify-content:center; gap:14px; margin:14px 0; flex-wrap:wrap }
    .tarot-card{ width:96px; height:152px; background:linear-gradient(135deg,#667eea 0%, #764ba2 100%); border-radius:10px; cursor:pointer; transition:all .3s; display:flex; align-items:center; justify-content:center; font-size:44px; border:3px solid rgba(255,255,255,.5); box-shadow:0 5px 20px rgba(0,0,0,.3); position:relative }
    .tarot-card:hover{ transform:translateY(-8px) }
    .tarot-card.flipped{ animation:cardFlip .6s ease-in-out }
    @keyframes cardFlip{0%,100%{transform:rotateY(0)}50%{transform:rotateY(180deg)}}

    footer{ margin-top: 16px; opacity:.9; font-size: 13px }

    @media (max-width:768px){
      .fairy{font-size:80px}
      .title{font-size:36px}
      .spray-button{font-size:18px;padding:12px 30px}
      .blessing-text{font-size:20px;white-space:normal;max-width:90%}
      .features-grid{grid-template-columns:1fr}
      .modal-content{padding:24px 18px}
      .fortune-result{font-size:46px}
      .fortune-text{font-size:18px}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">âœ¨ å¥½è¿å–·é›¾ âœ¨</h1>
    <div class="fairy" id="fairy">ğŸ§šâ€â™€ï¸</div>
    <button class="spray-button" id="sprayBtn">å–·æ´’å¥½è¿ âœ¨</button>

    <div class="features-grid">
      <div class="feature-card" onclick="openFortuneModal()">
        <div class="feature-icon">ğŸ”®</div>
        <div class="feature-title">ä»Šæ—¥è¿åŠ¿</div>
        <div class="feature-desc">æŠ½å–ä»Šå¤©çš„è¿åŠ¿ç­¾ï¼Œçœ‹çœ‹è¿æ°”å¦‚ä½•</div>
      </div>
      <div class="feature-card" onclick="openLuckyNumberModal()">
        <div class="feature-icon">ğŸ°</div>
        <div class="feature-title">å¹¸è¿æ•°å­—</div>
        <div class="feature-desc">ç”Ÿæˆä½ çš„ä¸“å±å¹¸è¿æ•°å­—</div>
      </div>
      <div class="feature-card" onclick="openCoinModal()">
        <div class="feature-icon">ğŸª™</div>
        <div class="feature-title">æŠ›ç¡¬å¸å†³ç­–</div>
        <div class="feature-desc">è®©å‘½è¿å¸®ä½ åšé€‰æ‹©</div>
      </div>
      <div class="feature-card" onclick="openTarotModal()">
        <div class="feature-icon">ğŸƒ</div>
        <div class="feature-title">å¡”ç½—å åœ</div>
        <div class="feature-desc">æŠ½å–å¡”ç½—ç‰ŒæŒ‡å¼•æ–¹å‘ï¼ˆå«é€†ä½ï¼‰</div>
      </div>
      <div class="feature-card" onclick="openEnergyModal()">
        <div class="feature-icon">âš¡</div>
        <div class="feature-title">èƒ½é‡å……èƒ½</div>
        <div class="feature-desc">ä¸ºè‡ªå·±æ³¨å…¥æ­£èƒ½é‡</div>
      </div>
      <div class="feature-card" onclick="openWishModal()">
        <div class="feature-icon">ğŸŒ </div>
        <div class="feature-title">è®¸æ„¿æ± </div>
        <div class="feature-desc">å†™ä¸‹æ„¿æœ›ï¼Œè®©å®ƒæˆçœŸ</div>
      </div>
      <div class="feature-card" onclick="openZodiacModal()">
        <div class="feature-icon">â™ˆ</div>
        <div class="feature-title">æ˜Ÿåº§/ç”Ÿè‚–åŠ æˆ</div>
        <div class="feature-desc">é€‰æ‹©åä¸ºç»“æœåšâ€œè½»å¾®åŠ æƒâ€</div>
      </div>
      <div class="feature-card" onclick="openPosterModal()">
        <div class="feature-icon">ğŸ–¼ï¸</div>
        <div class="feature-title">å¯¼å‡ºæµ·æŠ¥</div>
        <div class="feature-desc">æŠŠä»Šæ—¥ç»“æœç”Ÿæˆä¸€å¼ åˆ†äº«å›¾</div>
      </div>
    </div>
  </div>

  <div class="blessing-text" id="blessingText"></div>

  <!-- ä»Šæ—¥è¿åŠ¿ -->
  <div class="modal" id="fortuneModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('fortuneModal')">Ã—</span>
      <div class="modal-title">ğŸ”® ä»Šæ—¥è¿åŠ¿</div>
      <div class="fortune-card" id="fortuneCard" style="display:none;">
        <div class="fortune-result" id="fortuneEmoji"></div>
        <div class="fortune-text" id="fortuneLevel"></div>
        <div class="fortune-detail" id="fortuneDetail"></div>
      </div>
      <button class="btn" onclick="drawFortune()">æŠ½å–è¿åŠ¿</button>
    </div>
  </div>

  <!-- å¹¸è¿æ•°å­— -->
  <div class="modal" id="luckyNumberModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('luckyNumberModal')">Ã—</span>
      <div class="modal-title">ğŸ° å¹¸è¿æ•°å­—</div>
      <div class="lucky-number-display" id="luckyNumbers"></div>
      <div id="luckyExtra" class="fortune-detail" style="margin-bottom:10px;"></div>
      <button class="btn" onclick="generateLuckyNumbers()">ç”Ÿæˆå¹¸è¿æ•°å­—</button>
    </div>
  </div>

  <!-- æŠ›ç¡¬å¸ -->
  <div class="modal" id="coinModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('coinModal')">Ã—</span>
    <div class="modal-title">ğŸª™ æŠ›ç¡¬å¸å†³ç­–</div>
      <div class="coins-container">
        <div class="coin" onclick="flipCoin(this)">ğŸª™</div>
      </div>
      <div class="fortune-text" id="coinResult" style="margin-top:6px;"></div>
      <div class="fortune-detail">ç‚¹å‡»ç¡¬å¸è¿›è¡ŒæŠ›æ·</div>
    </div>
  </div>

  <!-- å¡”ç½— -->
  <div class="modal" id="tarotModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('tarotModal')">Ã—</span>
      <div class="modal-title">ğŸƒ å¡”ç½—å åœ</div>
      <div class="tarot-cards" id="tarotCards"></div>
      <div class="fortune-card" id="tarotResult" style="display:none; margin-top:10px;">
        <div class="fortune-result" id="tarotEmoji"></div>
        <div class="fortune-text" id="tarotTitle"></div>
        <div class="fortune-detail" id="tarotDetail"></div>
      </div>
    </div>
  </div>

  <!-- èƒ½é‡å……èƒ½ -->
  <div class="modal" id="energyModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('energyModal')">Ã—</span>
      <div class="modal-title">âš¡ èƒ½é‡å……èƒ½</div>
      <div class="energy-bar">
        <div class="energy-fill" id="energyFill" style="width:0%">0%</div>
      </div>
      <button class="btn" onclick="chargeEnergy()">å¼€å§‹å……èƒ½</button>
      <div class="fortune-detail" style="margin-top:8px;">ç‚¹å‡»æŒ‰é’®ä¸ºè‡ªå·±æ³¨å…¥æ»¡æ»¡çš„æ­£èƒ½é‡ï¼</div>
    </div>
  </div>

  <!-- è®¸æ„¿æ±  -->
  <div class="modal" id="wishModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('wishModal')">Ã—</span>
      <div class="modal-title">ğŸŒ  è®¸æ„¿æ± </div>
      <textarea id="wishText" style="width:100%;height:120px;border-radius:12px;padding:12px;font-size:16px;border:2px solid var(--border);background:var(--panel);resize:none;color:#fff;" placeholder="å†™ä¸‹ä½ çš„æ„¿æœ›..."></textarea>
      <button class="btn" onclick="makeWish()" style="margin-top:12px;">æŠ•å…¥è®¸æ„¿æ± </button>
      <div id="wishResult" style="margin-top:12px;font-size:16px;"></div>
    </div>
  </div>

  <!-- æ˜Ÿåº§/ç”Ÿè‚– -->
  <div class="modal" id="zodiacModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('zodiacModal')">Ã—</span>
      <div class="modal-title">â™ˆ æ˜Ÿåº§ / ç”Ÿè‚– åŠ æˆ</div>
      <div class="fortune-card" style="text-align:left; font-size:14px;">
        <label>æ˜Ÿåº§ï¼š
          <select id="signSel">
            <option value="">æœªé€‰æ‹©</option>
            <option>ç™½ç¾Š</option><option>é‡‘ç‰›</option><option>åŒå­</option><option>å·¨èŸ¹</option>
            <option>ç‹®å­</option><option>å¤„å¥³</option><option>å¤©ç§¤</option><option>å¤©è</option>
            <option>å°„æ‰‹</option><option>æ‘©ç¾¯</option><option>æ°´ç“¶</option><option>åŒé±¼</option>
          </select>
        </label>
        <br/>
        <label>ç”Ÿè‚–ï¼š
          <select id="zodiacSel">
            <option value="">æœªé€‰æ‹©</option>
            <option>é¼ </option><option>ç‰›</option><option>è™</option><option>å…”</option>
            <option>é¾™</option><option>è›‡</option><option>é©¬</option><option>ç¾Š</option>
            <option>çŒ´</option><option>é¸¡</option><option>ç‹—</option><option>çŒª</option>
          </select>
        </label>
      </div>
      <button class="btn" onclick="saveProfile()">åº”ç”¨åŠ æˆ</button>
      <div class="fortune-detail" style="margin-top:8px;">åŠ æˆå°†è½»å¾®å½±å“â€œè¿åŠ¿/å¹¸è¿æ•°å­—/å¹¸è¿è‰²â€ã€‚</div>
    </div>
  </div>

  <!-- å¯¼å‡ºæµ·æŠ¥ -->
  <div class="modal" id="posterModal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('posterModal')">Ã—</span>
      <div class="modal-title">ğŸ–¼ï¸ å¯¼å‡ºæµ·æŠ¥</div>
      <canvas id="posterCanvas" width="864" height="1536" style="width:270px;height:480px;border-radius:12px;border:2px solid var(--border);"></canvas>
      <div class="fortune-detail" style="margin:10px 0;">å°†å½“å‰â€œè¿åŠ¿/å¹¸è¿è‰²/æ„¿æœ›â€åˆæˆ PNG å›¾ç‰‡</div>
      <button class="btn" onclick="renderPoster()">ç”Ÿæˆæµ·æŠ¥</button>
      <button class="btn" onclick="downloadPoster()" style="margin-left:8px;">ä¿å­˜ PNG</button>
    </div>
  </div>

  <script>
    // ===== æ–‡æ¡ˆä¸æ•°æ® =====
    const defaultBlessings = [
      "ä»Šå¤©ä¸€å®šä¼šè¶…çº§é¡ºåˆ©ï¼âœ¨","å¥½è¿æ­£åœ¨é è¿‘ä½  ğŸ’«","ä½ å€¼å¾—è¢«æ¸©æŸ”å¯¹å¾… ğŸ’•","å¹¸ç¦ä¼šåœ¨ä¸ç»æ„é—´é™ä¸´ ğŸŒ¸",
      "æ‰€æœ‰ç¾å¥½éƒ½ä¼šå¦‚æœŸè€Œè‡³ ğŸŒˆ","ä»Šå¤©çš„ä½ é—ªé—ªå‘å…‰ â­","æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾… ğŸŒº","å¥½äº‹å³å°†å‘ç”Ÿ ğŸ‰",
      "ä½ çš„ç¬‘å®¹ä¼šå¸¦æ¥å¥½è¿ ğŸ˜Š","å¿ƒæƒ³äº‹æˆï¼Œä¸‡äº‹å¦‚æ„ ğŸŠ","ç¾å¥½çš„äº‹æƒ…æ­£åœ¨è·¯ä¸Š ğŸ¦‹","ä½ ä¼šæ”¶åˆ°æ„å¤–çš„æƒŠå–œ ğŸ",
      "ä»Šå¤©é‡åˆ°çš„éƒ½æ˜¯å¥½äºº ğŸ’–","è¿æ°”çˆ†æ£šçš„ä¸€å¤©å¼€å§‹äº† ğŸŒŸ","æ‰€æœ‰éš¾é¢˜éƒ½ä¼šè¿åˆƒè€Œè§£ ğŸ’ª","å¹¸è¿å¥³ç¥åœ¨å¯¹ä½ å¾®ç¬‘ ğŸ˜‡",
      "æŠŠå¤æ‚ç•™ç»™æ˜¨å¤©ï¼ŒæŠŠå¥½è¿ç•™ç»™ä»Šå¤© âœ¨","å®‡å®™æ­£åœ¨æ‚„æ‚„åçˆ±ä½  ğŸŒŒ","å°å°çš„åšæŒä¹Ÿä¼šå‘å…‰ ğŸ”†","æ„¿ä¸€åˆ‡å¦‚ä½ æ‰€æ„¿ ğŸª„"
    ];
    let blessings = defaultBlessings.slice();

    const emojis = ['âœ¨','ğŸ’«','ğŸŒŸ','ğŸŒ¸','ğŸ’–','ğŸ€','ğŸ¦‹','ğŸˆ','ğŸŒˆ','â­'];
    const directions = ['æ­£ä¸œ','ä¸œå—','æ­£å—','è¥¿å—','æ­£è¥¿','è¥¿åŒ—','æ­£åŒ—','ä¸œåŒ—'];
    const colors = ['æ¨±èŠ±ç²‰','è–„è·ç»¿','å¤©é’è“','æŸ æª¬é»„','è–°è¡£è‰ç´«','çŠç‘šæ©™','å¥¶æ²¹ç™½','å®çŸ³è“','ç¥–æ¯ç»¿','çŸ³è‹±ç²‰'];
    const zodiacPrefColors = { é¾™:['å®çŸ³è“','ç¥–æ¯ç»¿'], è™:['çŠç‘šæ©™','æŸ æª¬é»„'], é©¬:['æ¨±èŠ±ç²‰','å¥¶æ²¹ç™½'], ç‹—:['å¤©é’è“','çŸ³è‹±ç²‰'] };

    const tarotData = [
      { name:"æ„šè€…", emoji:"ğŸ§­", detail:"æ–°çš„æ—…ç¨‹ã€è‡ªç”±ã€ä¿¡ä»»ç›´è§‰ã€‚" },
      { name:"é­”æœ¯å¸ˆ", emoji:"ğŸª„", detail:"èµ„æºä¸æ„å¿—åŠ›é½å¤‡ï¼Œå¼€å§‹åˆ›é€ ã€‚" },
      { name:"å¥³ç¥­å¸", emoji:"ğŸŒ™", detail:"å€¾å¬å†…å¿ƒä¸ç›´è§‰ï¼Œä¿æŒç¥ç§˜ã€‚" },
      { name:"çš‡å", emoji:"ğŸŒ¿", detail:"ä¸°é¥¶ã€æ»‹å…»ã€è‰ºæœ¯ä¸äº«å—ã€‚" },
      { name:"çš‡å¸", emoji:"ğŸ›ï¸", detail:"ç§©åºã€ç»“æ„ã€æƒå¨ä¸æ‹…å½“ã€‚" },
      { name:"æ•™çš‡", emoji:"ğŸ“œ", detail:"ä¼ ç»Ÿã€å­¦ä¹ ä¸ç²¾ç¥æŒ‡å¼•ã€‚" },
      { name:"æ‹äºº", emoji:"ğŸ’•", detail:"äº²å¯†ã€é€‰æ‹©ã€ä»·å€¼è§‚çš„ä¸€è‡´ã€‚" },
      { name:"æˆ˜è½¦", emoji:"ğŸ›¡ï¸", detail:"æ„å¿—ä¸èƒœåˆ©ï¼Œç¨³ä½æ–¹å‘ã€‚" },
      { name:"åŠ›é‡", emoji:"ğŸ’ª", detail:"æ¸©æŸ”çš„å‹‡æ°”ä¸è‡ªæˆ‘æŒæ§ã€‚" },
      { name:"éšè€…", emoji:"ğŸ•¯ï¸", detail:"ç‹¬å¤„æ€è€ƒï¼Œå¯»æ‰¾çœŸç†ä¹‹ç¯ã€‚" },
      { name:"å‘½è¿ä¹‹è½®", emoji:"ğŸ¡", detail:"å‘¨æœŸå˜åŒ–ï¼ŒæŠ“ä½è½¬æœºã€‚" },
      { name:"æ­£ä¹‰", emoji:"âš–ï¸", detail:"å…¬å¹³ã€å› æœã€ç†æ€§æŠ‰æ‹©ã€‚" },
      { name:"å€’åŠäºº", emoji:"ğŸª¢", detail:"æ¢ä¸ªè§†è§’ï¼Œæš‚ç¼“è¡ŒåŠ¨ã€‚" },
      { name:"æ­»äº¡", emoji:"ğŸ¦‚", detail:"ç»“æŸå³å¼€å§‹ï¼Œæœæ–­å‰²èˆã€‚" },
      { name:"èŠ‚åˆ¶", emoji:"ğŸ’§", detail:"å¹³è¡¡ä¸è°ƒå’Œï¼ŒæŒæ¡èŠ‚å¥ã€‚" },
      { name:"æ¶é­”", emoji:"ğŸª¤", detail:"è­¦æƒ•è¯±æƒ‘ï¼Œæ¾å¼€æ‰§å¿µã€‚" },
      { name:"é«˜å¡”", emoji:"âš¡", detail:"çªå˜ä¸é‡å»ºï¼Œæ‰“ç ´æ—§æ¡†æ¶ã€‚" },
      { name:"æ˜Ÿæ˜Ÿ", emoji:"â­", detail:"å¸Œæœ›ä¸ç–—æ„ˆï¼Œå…‰ç…§å‰è·¯ã€‚" },
      { name:"æœˆäº®", emoji:"ğŸŒ™", detail:"æ½œæ„è¯†ã€æ¢¦å¢ƒã€ç›´è§‰æé†’ã€‚" },
      { name:"å¤ªé˜³", emoji:"â˜€ï¸", detail:"æˆåŠŸã€å–œæ‚¦ä¸ç«¥çœŸåŠ›é‡ã€‚" },
      { name:"å®¡åˆ¤", emoji:"ğŸ“£", detail:"è§‰é†’ã€å¬å”¤ä¸è‡ªæˆ‘å’Œè§£ã€‚" },
      { name:"ä¸–ç•Œ", emoji:"ğŸŒ", detail:"å®Œæˆã€æ•´åˆä¸åœ†æ»¡ã€‚" }
    ];

    const fortunes = [
      { level:"å¤§å‰", emoji:"ğŸŒŸ", base:20, detail:"ä»Šå¤©è¿æ°”çˆ†æ£šï¼åšä»€ä¹ˆéƒ½ä¼šç‰¹åˆ«é¡ºåˆ©ï¼Œæ˜¯å®ç°æ„¿æœ›çš„å¥½æ—¥å­ï¼" },
      { level:"ä¸­å‰", emoji:"âœ¨", base:16, detail:"è¿åŠ¿ä¸é”™ï¼Œä¼šæœ‰å°æƒŠå–œå‡ºç°ï¼Œä¿æŒç§¯æå¿ƒæ€ä¼šæ›´å¥½ï¼" },
      { level:"å°å‰", emoji:"ğŸ€", base:12, detail:"å¹³ç¨³çš„ä¸€å¤©ï¼Œè¸å®åšäº‹ä¼šæœ‰å¥½ç»“æœï¼Œé€‚åˆç¨³æ­¥å‰è¿›ã€‚" },
      { level:"å‰",   emoji:"ğŸ’«", base:10, detail:"æ•´ä½“é¡ºåˆ©ï¼Œå¶å°”æœ‰å°æ³¢æŠ˜ï¼Œä½†æœ€ç»ˆéƒ½èƒ½åŒ–è§£ã€‚" },
      { level:"åŠå‰", emoji:"ğŸŒˆ", base: 8, detail:"è¿åŠ¿å¹³å¹³ï¼Œä¿æŒå¹³å¸¸å¿ƒï¼Œä¸è¦å†’é™©å°è¯•æ–°äº‹ç‰©ã€‚" },
      { level:"æœ«å‰", emoji:"ğŸŒ¸", base: 6, detail:"éœ€è¦å¤šåŠ å°å¿ƒï¼Œä½†è°¨æ…è¡Œäº‹å°±æ²¡é—®é¢˜ã€‚" },
      { level:"å‡¶è½¬å‰", emoji:"ğŸŒ¤ï¸", base:14, detail:"é€¢å‡¶åŒ–å‰çš„ä¸€å¤©ï¼Œå…ˆéš¾åæ˜“ï¼Œä¿æŒè€å¿ƒã€‚" }
    ];

    // ===== çŠ¶æ€ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ =====
    const LS_KEY = 'lucky_app_v1';
    let state = {
      profile: { sign:'', zodiac:'' },
      last: { fortune:null, luckColor:null, numbers:[], wish:'' }
    };
    try { const s = JSON.parse(localStorage.getItem(LS_KEY)); if (s) state = Object.assign(state, s); } catch(e){}

    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

    // ===== ç‰¹æ•ˆ & ä¸»æŒ‰é’® =====
    function createParticles(x,y){
      const num=30;
      for(let i=0;i<num;i++){
        const el=document.createElement('div');
        el.className='particle';
        el.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        const ang=(Math.PI*2*i)/num;
        const dist=100+Math.random()*200;
        const tx=Math.cos(ang)*dist, ty=Math.sin(ang)*dist;
        el.style.left=x+'px'; el.style.top=y+'px';
        el.style.setProperty('--tx',tx+'px'); el.style.setProperty('--ty',ty+'px');
        document.body.appendChild(el);
        setTimeout(()=>el.remove(),2000);
      }
    }

    function showBlessing(){
      const msg = blessings[Math.floor(Math.random()*blessings.length)];
      const box = document.getElementById('blessingText');
      box.textContent = msg;
      box.classList.remove('show'); void box.offsetWidth;
      box.classList.add('show');
    }

    function sprayLuck(){
      const fairy=document.getElementById('fairy');
      fairy.classList.add('spraying'); setTimeout(()=>fairy.classList.remove('spraying'),500);
      const r = fairy.getBoundingClientRect();
      createParticles(r.left + r.width/2, r.top + r.height/2);
      setTimeout(showBlessing, 200);
    }
    document.getElementById('sprayBtn').addEventListener('click',sprayLuck);
    document.getElementById('fairy').addEventListener('click',sprayLuck);

    // ===== Modal é€šç”¨ =====
    function openModal(id){ document.getElementById(id).classList.add('active'); }
    function closeModal(id){ document.getElementById(id).classList.remove('active'); }

    // ===== ä»Šæ—¥è¿åŠ¿ï¼ˆå«æ˜Ÿåº§/ç”Ÿè‚–æƒé‡ï¼‰ =====
    const signBias = { ç«:["ç™½ç¾Š","ç‹®å­","å°„æ‰‹"], åœŸ:["é‡‘ç‰›","å¤„å¥³","æ‘©ç¾¯"], é£:["åŒå­","å¤©ç§¤","æ°´ç“¶"], æ°´:["å·¨èŸ¹","å¤©è","åŒé±¼"] };
    function weightedPickFortune(){
      let w=[1.3,1.15,1.05,1.0,0.95,0.9,1.1]; // å„ç­‰çº§æƒé‡
      const s=state.profile.sign||'', z=state.profile.zodiac||'';
      if(signBias.ç«.includes(s)) w=[1.5,1.2,1.05,1.0,0.95,0.9,1.2];
      if(signBias.åœŸ.includes(s)) w=[1.2,1.1,1.1,1.05,1.0,0.95,1.05];
      if(signBias.é£.includes(s)) w=[1.35,1.2,1.05,1.05,1.0,0.95,1.1];
      if(signBias.æ°´.includes(s)) w=[1.25,1.15,1.1,1.05,1.0,0.95,1.1];
      if(['é¾™','è™','é©¬','ç‹—'].includes(z)) w[0]+=0.15; // å¤§å‰ç•¥å¢
      const pool = fortunes.flatMap((f,i)=>Array(Math.round(w[i]*10)).fill(i));
      return fortunes[ pool[Math.floor(Math.random()*pool.length)] ];
    }
    function openFortuneModal(){ openModal('fortuneModal'); document.getElementById('fortuneCard').style.display='none'; }
    function drawFortune(){
      const f = weightedPickFortune();
      document.getElementById('fortuneEmoji').textContent = f.emoji;
      document.getElementById('fortuneLevel').textContent = f.level;
      document.getElementById('fortuneDetail').textContent = f.detail;
      document.getElementById('fortuneCard').style.display='block';
      state.last.fortune = f; saveState();
    }

    // ===== å¹¸è¿æ•°å­—ï¼ˆéšæ˜Ÿåº§å¾®åç½®ï¼‰ + å¹¸è¿è‰²/æ–¹å‘æç¤º =====
    function openLuckyNumberModal(){
      openModal('luckyNumberModal');
      document.getElementById('luckyNumbers').innerHTML='';
      document.getElementById('luckyExtra').textContent='';
    }
    function generateLuckyNumbers(){
      const box=document.getElementById('luckyNumbers'); box.innerHTML='';
      const set=new Set();
      const bias = (['ç™½ç¾Š','ç‹®å­','å°„æ‰‹'].includes(state.profile.sign)? 3: ['é‡‘ç‰›','å¤„å¥³','æ‘©ç¾¯'].includes(state.profile.sign)? 1: 2);
      while(set.size<6){
        const r=1+Math.floor(Math.abs(Math.sin(Date.now()+Math.random()*999))*49);
        const n=((r+bias)%49)+1; set.add(n);
      }
      const arr=[...set].sort((a,b)=>a-b);
      state.last.numbers = arr; saveState();
      arr.forEach(n=>{ const d=document.createElement('div'); d.className='lucky-number'; d.textContent=n; box.appendChild(d); });
      // é™„åŠ å¹¸è¿è‰²/æ–¹å‘
      const pref = zodiacPrefColors[state.profile.zodiac]||[];
      const palette = pref.length? pref.concat(colors).slice(0,Math.max(6,pref.length+4)) : colors;
      const color = palette[Math.floor(Math.random()*palette.length)];
      const dir = directions[Math.floor(Math.random()*directions.length)];
      state.last.luckColor = {color, dir}; saveState();
      document.getElementById('luckyExtra').textContent = `å¹¸è¿è‰²ï¼š${color} Â· å¹¸è¿æ–¹å‘ï¼š${dir}`;
    }

    // ===== æŠ›ç¡¬å¸ =====
    function openCoinModal(){ openModal('coinModal'); document.getElementById('coinResult').textContent=''; }
    function flipCoin(el){
      el.classList.add('flipping');
      setTimeout(()=>{
        el.classList.remove('flipping');
        const heads = Math.random()<0.5;
        document.getElementById('coinResult').textContent = heads ? 'æ­£é¢ï¼šå»åšï¼âœ…' : 'åé¢ï¼šå†æƒ³æƒ³ï½ ğŸ¤”';
      },1000);
    }

    // ===== å¡”ç½—ï¼ˆ3é€‰1 + é€†ä½ï¼‰ =====
    function openTarotModal(){
      openModal('tarotModal');
      const wrap=document.getElementById('tarotCards'); wrap.innerHTML=''; document.getElementById('tarotResult').style.display='none';
      for(let i=0;i<3;i++){
        const c=document.createElement('div');
        c.className='tarot-card'; c.textContent='ğŸ”®';
        c.addEventListener('click',()=>revealTarot(c,wrap));
        wrap.appendChild(c);
      }
    }
    function revealTarot(card, wrap){
      [...wrap.children].forEach(n=>n.style.pointerEvents='none');
      card.classList.add('flipped');
      setTimeout(()=>{
        const t = tarotData[Math.floor(Math.random()*tarotData.length)];
        const reversed = Math.random()<0.5;
        document.getElementById('tarotEmoji').textContent = t.emoji;
        document.getElementById('tarotTitle').textContent = t.name + (reversed?'ï¼ˆé€†ä½ï¼‰':'');
        document.getElementById('tarotDetail').textContent = reversed ? (`é€†ä½æç¤ºï¼šæ”¾æ…¢è„šæ­¥ï¼Œæ¢³ç†æƒ…ç»ªå†è¡ŒåŠ¨ã€‚â€” ${t.detail}`) : t.detail;
        document.getElementById('tarotResult').style.display='block';
      },300);
    }

    // ===== èƒ½é‡å……èƒ½ =====
    function openEnergyModal(){ openModal('energyModal'); const f=document.getElementById('energyFill'); f.style.width='0%'; f.textContent='0%'; }
    function chargeEnergy(){
      const f=document.getElementById('energyFill'); let cur=0;
      const target=70+Math.floor(Math.random()*31);
      const id=setInterval(()=>{
        cur=Math.min(target, cur + 5 + Math.floor(Math.random()*10));
        f.style.width=cur+'%'; f.textContent=cur+'%';
        if(cur>=target){ clearInterval(id); }
      },120);
    }

    // ===== è®¸æ„¿æ±  =====
    function openWishModal(){ openModal('wishModal'); document.getElementById('wishText').value=''; document.getElementById('wishResult').textContent=''; }
    function makeWish(){
      const txt=document.getElementById('wishText').value.trim();
      const r=document.getElementById('wishResult');
      if(!txt){ r.textContent='å†™ç‚¹ä»€ä¹ˆå§ï½ï¼ˆæ„¿æœ›ä¸èƒ½ä¸ºç©ºï¼‰'; return; }
      state.last.wish = txt; saveState();
      r.textContent='å·²æŠ•å…¥è®¸æ„¿æ± ï¼æ„¿æœ›æ­£åœ¨å®‡å®™æ’é˜Ÿå®ç°ä¸­ âœ¨';
      const cx=window.innerWidth/2, cy=window.innerHeight/2;
      createParticles(cx,cy);
    }

    // ===== æ˜Ÿåº§/ç”Ÿè‚– =====
    function openZodiacModal(){
      openModal('zodiacModal');
      document.getElementById('signSel').value = state.profile.sign || '';
      document.getElementById('zodiacSel').value = state.profile.zodiac || '';
    }
    function saveProfile(){
      state.profile.sign = document.getElementById('signSel').value;
      state.profile.zodiac = document.getElementById('zodiacSel').value;
      saveState(); closeModal('zodiacModal');
    }

    // ===== æµ·æŠ¥ç”Ÿæˆ =====
    function openPosterModal(){ openModal('posterModal'); }
    function wrapText(ctx, text, cx, y, maxWidth, lineHeight){
      const words=[...text]; let line=''; let yy=y; ctx.textAlign='center';
      words.forEach(ch=>{
        const test=line+ch;
        if(ctx.measureText(test).width>maxWidth){ ctx.fillText(line, cx, yy); line=ch; yy+=lineHeight; }
        else { line=test; }
      });
      ctx.fillText(line, cx, yy);
    }
    function renderPoster(){
      const cvs=document.getElementById('posterCanvas'); const ctx=cvs.getContext('2d'); const W=cvs.width, H=cvs.height;
      ctx.clearRect(0,0,W,H);
      const g=ctx.createLinearGradient(0,0,W,H); g.addColorStop(0,'#667eea'); g.addColorStop(.5,'#764ba2'); g.addColorStop(1,'#f093fb'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
      // æ ‡é¢˜ & æ—¥æœŸ
      ctx.fillStyle='rgba(255,255,255,.95)'; ctx.font='bold 64px Arial'; ctx.textAlign='center'; ctx.fillText('å¥½è¿å–·é›¾', W/2, 120);
      ctx.font='24px Arial'; ctx.fillText(new Date().toLocaleString(), W/2, 160);
      // è¿åŠ¿
      const f=state.last.fortune||{emoji:'âœ¨',level:'å°šæœªæŠ½ç­¾',detail:'ç‚¹å‡»â€œä»Šæ—¥è¿åŠ¿â€æŠ½å–å§ï½'};
      ctx.font='56px Arial'; ctx.fillText(`${f.emoji} ${f.level}`, W/2, 250);
      ctx.font='28px Arial'; wrapText(ctx, f.detail, W/2, 295, W-160, 34);
      // å¹¸è¿è‰²/æ–¹å‘
      const lc=state.last.luckColor||{color:'æœªç”Ÿæˆ',dir:'â€”'};
      ctx.font='32px Arial'; ctx.fillText(`ğŸ¨ ${lc.color} Â· ${lc.dir}`, W/2, 400);
      // å¹¸è¿æ•°å­—
      ctx.font='28px Arial';
      const nums = state.last.numbers && state.last.numbers.length ? state.last.numbers.join('  ') : 'ï¼ˆå°šæœªç”Ÿæˆï¼‰';
      ctx.fillText(`ğŸ° å¹¸è¿æ•°å­—ï¼š${nums}`, W/2, 450);
      // æ„¿æœ›
      const wish = state.last.wish || 'å†™ä¸‹ä½ çš„æ„¿æœ›å§ï½';
      ctx.font='bold 36px Arial'; ctx.fillText('ğŸŒ  ä»Šæ—¥æ„¿æœ›', W/2, 520);
      ctx.font='28px Arial'; wrapText(ctx, wish, W/2, 560, W-180, 34);
      // åº•éƒ¨
      ctx.font='22px Arial'; ctx.fillStyle='rgba(255,255,255,.9)'; ctx.fillText('Made with â¤ï¸', W/2, H-60);
    }
    function downloadPoster(){
      const a=document.createElement('a'); a.href=document.getElementById('posterCanvas').toDataURL('image/png'); a.download='å¥½è¿æµ·æŠ¥.png'; a.click();
    }

    // ===== å…¥å£å‡½æ•°åˆ«åï¼ˆæ–¹ä¾¿ç»‘å®šï¼‰ =====
    function openFortuneModal(){ openModal('fortuneModal'); document.getElementById('fortuneCard').style.display='none'; }
    function openLuckyNumberModal(){ openModal('luckyNumberModal'); document.getElementById('luckyNumbers').innerHTML=''; document.getElementById('luckyExtra').textContent=''; }
    function openCoinModal(){ openModal('coinModal'); document.getElementById('coinResult').textContent=''; }
    function openTarotModal(){ openModal('tarotModal'); const wrap = document.getElementById('tarotCards'); wrap.innerHTML=''; document.getElementById('tarotResult').style.display='none'; for(let i=0;i<3;i++){ const c=document.createElement('div'); c.className='tarot-card'; c.textContent='ğŸ”®'; c.addEventListener('click',()=>revealTarot(c,wrap)); wrap.appendChild(c);} }
    function openEnergyModal(){ openModal('energyModal'); const f=document.getElementById('energyFill'); f.style.width='0%'; f.textContent='0%'; }
    function openWishModal(){ openModal('wishModal'); document.getElementById('wishText').value=''; document.getElementById('wishResult').textContent=''; }
    function openZodiacModal(){ openModal('zodiacModal'); document.getElementById('signSel').value=state.profile.sign||''; document.getElementById('zodiacSel').value=state.profile.zodiac||''; }
    function openPosterModal(){ openModal('posterModal'); }
  </script>
</body>
</html>
