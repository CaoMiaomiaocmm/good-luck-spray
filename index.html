<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>好运喷雾 ✨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px;
        }
        @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        .container { text-align: center; z-index: 10; position: relative; max-width: 1200px; width: 100%; }
        .fairy { font-size: 120px; animation: float 3s ease-in-out infinite; cursor: pointer; transition: transform .3s; user-select: none; }
        .fairy:hover { transform: scale(1.1) }
        .fairy.spraying { animation: spray .5s ease-out }
        @keyframes float { 0%,100%{transform: translateY(0)} 50%{transform: translateY(-20px)} }
        @keyframes spray { 0%{transform:scale(1) rotate(0)} 50%{transform:scale(1.2) rotate(-10deg)} 100%{transform:scale(1) rotate(0)} }
        .spray-button { margin-top:30px; padding:15px 40px; font-size:20px; background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%); border:none; border-radius:50px; color:#fff; cursor:pointer; box-shadow:0 10px 30px rgba(0,0,0,.3); transition:all .3s; font-weight:bold; }
        .spray-button:hover { transform: translateY(-3px); box-shadow:0 15px 40px rgba(0,0,0,.4) }
        .blessing-text { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:32px; color:#fff; text-shadow:0 0 20px rgba(255,255,255,.8); opacity:0; pointer-events:none; font-weight:bold; white-space:nowrap; z-index:100 }
        .blessing-text.show { animation: blessAppear 3s ease-out forwards }
        @keyframes blessAppear { 0%{opacity:0; transform:translate(-50%,-50%) scale(.5)} 20%{opacity:1; transform:translate(-50%,-50%) scale(1.2)} 80%{opacity:1; transform:translate(-50%,-50%) scale(1)} 100%{opacity:0; transform:translate(-50%,-50%) scale(1)} }
        .particle { position:fixed; pointer-events:none; font-size:24px; animation: particleFall 2s ease-out forwards; z-index:99 }
        @keyframes particleFall { 0%{opacity:1; transform:translate(0,0) rotate(0) scale(0)} 50%{opacity:1; transform:translate(var(--tx),var(--ty)) rotate(360deg) scale(1)} 100%{opacity:0; transform:translate(calc(var(--tx)*1.5), calc(var(--ty)*2)) rotate(720deg) scale(.5)} }
        .flash-overlay { position:fixed; inset:0; background: radial-gradient(circle, rgba(255,255,255,.8) 0%, rgba(255,255,255,0) 70%); opacity:0; pointer-events:none; z-index:50 }
        .flash-overlay.active { animation: flash .5s ease-out }
        @keyframes flash { 0%{opacity:0} 50%{opacity:1} 100%{opacity:0} }
        .title { color:#fff; font-size:48px; text-shadow:0 0 20px rgba(255,255,255,.5); margin-bottom:20px; font-weight:bold }
        .features-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:20px; margin-top:40px; max-width:1200px }
        .feature-card { background:rgba(255,255,255,.15); backdrop-filter: blur(10px); border-radius:20px; padding:25px; border:2px solid rgba(255,255,255,.3); cursor:pointer; transition:all .3s; text-align:center }
        .feature-card:hover { transform: translateY(-5px); background:rgba(255,255,255,.25); box-shadow:0 10px 30px rgba(0,0,0,.3) }
        .feature-icon { font-size:60px; margin-bottom:15px }
        .feature-title { color:#fff; font-size:22px; font-weight:bold; margin-bottom:10px }
        .feature-desc { color:rgba(255,255,255,.9); font-size:14px }
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:200; justify-content:center; align-items:center; padding:20px }
        .modal.active { display:flex }
        .modal-content { background: linear-gradient(135deg,#667eea 0%, #764ba2 100%); border-radius:30px; padding:40px; max-width:500px; width:100%; border:3px solid rgba(255,255,255,.4); box-shadow:0 20px 60px rgba(0,0,0,.5); text-align:center; position:relative; animation: modalAppear .3s ease-out }
        @keyframes modalAppear { from{opacity:0; transform:scale(.8)} to{opacity:1; transform:scale(1)} }
        .close-modal { position:absolute; top:15px; right:20px; font-size:30px; color:#fff; cursor:pointer; line-height:1 }
        .modal-title { color:#fff; font-size:32px; margin-bottom:30px; font-weight:bold }
        .fortune-card { background:rgba(255,255,255,.2); backdrop-filter: blur(10px); border-radius:20px; padding:30px; margin:20px 0; border:2px solid rgba(255,255,255,.3) }
        .fortune-result { font-size:60px; margin-bottom:20px }
        .fortune-text { color:#fff; font-size:24px; font-weight:bold; margin-bottom:15px }
        .fortune-detail { color:rgba(255,255,255,.9); font-size:16px; line-height:1.6 }
        .draw-button { padding:15px 40px; font-size:18px; background:linear-gradient(135deg,#f5576c 0%, #f093fb 100%); border:none; border-radius:50px; color:#fff; cursor:pointer; font-weight:bold; transition:all .3s; box-shadow:0 5px 20px rgba(0,0,0,.3) }
        .draw-button:hover { transform: scale(1.05) }
        .lucky-number-display { display:flex; justify-content:center; gap:15px; margin:30px 0; flex-wrap:wrap }
        .lucky-number { width:60px; height:60px; background:linear-gradient(135deg,#f093fb 0%, #f5576c 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:24px; font-weight:bold; box-shadow:0 5px 15px rgba(0,0,0,.3); animation: numberPop .5s ease-out }
        @keyframes numberPop { 0%{transform:scale(0) rotate(0)} 50%{transform:scale(1.2) rotate(180deg)} 100%{transform:scale(1) rotate(360deg)} }
        .coins-container { display:flex; justify-content:center; gap:20px; margin:30px 0; flex-wrap:wrap }
        .coin { width:80px; height:80px; background:linear-gradient(135deg,#ffd700 0%, #ffed4e 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:40px; cursor:pointer; transition:all .3s; box-shadow:0 5px 20px rgba(255,215,0,.5); border:3px solid #fff }
        .coin:hover { transform: scale(1.1) rotate(10deg) }
        .coin.flipping { animation: coinFlip 1s ease-in-out }
        @keyframes coinFlip { 0%{transform: rotateY(0)} 100%{transform: rotateY(1080deg)} }
        .energy-bar { width:100%; height:30px; background:rgba(255,255,255,.2); border-radius:15px; overflow:hidden; margin:20px 0; border:2px solid rgba(255,255,255,.3) }
        .energy-fill { height:100%; background:linear-gradient(90deg,#4facfe 0%, #00f2fe 100%); transition:width .5s ease; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold }
        .tarot-cards { display:flex; justify-content:center; gap:20px; margin:30px 0; flex-wrap:wrap }
        .tarot-card { width:100px; height:160px; background:linear-gradient(135deg,#667eea 0%, #764ba2 100%); border-radius:10px; cursor:pointer; transition:all .3s; display:flex; align-items:center; justify-content:center; font-size:50px; border:3px solid rgba(255,255,255,.5); box-shadow:0 5px 20px rgba(0,0,0,.3); position:relative }
        .tarot-card:hover { transform: translateY(-10px) }
        .tarot-card.flipped { animation: cardFlip .6s ease-in-out }
        @keyframes cardFlip { 0%,100%{transform: rotateY(0)} 50%{transform: rotateY(180deg)} }
        .stats-container { background:rgba(255,255,255,.15); backdrop-filter: blur(10px); border-radius:20px; padding:20px; margin-top:30px; border:2px solid rgba(255,255,255,.3) }
        .stat-item { display:flex; justify-content:space-between; color:#fff; margin:10px 0; font-size:18px }
        .stat-value { font-weight:bold; color:#ffd700 }
        footer { margin-top: 28px; color: rgba(255,255,255,.9); font-size: 14px }
        @media (max-width:768px){ .fairy{font-size:80px} .title{font-size:36px} .spray-button{font-size:18px; padding:12px 30px} .blessing-text{font-size:20px; white-space:normal; max-width:90%} .features-grid{grid-template-columns:1fr} .modal-content{padding:30px 20px} .fortune-result{font-size:50px} .fortune-text{font-size:20px} }
    </style>
</head>
<body>
    <div class="flash-overlay" id="flashOverlay"></div>
    <div class="container">
        <h1 class="title">✨ 好运喷雾 ✨</h1>
        <div class="fairy" id="fairy">🧚‍♀️</div>
        <button class="spray-button" id="sprayBtn">喷洒好运 ✨</button>

        <div class="features-grid">
            <div class="feature-card" onclick="openFortuneModal()">
                <div class="feature-icon">🔮</div>
                <div class="feature-title">今日运势</div>
                <div class="feature-desc">抽取今天的运势签，看看运气如何</div>
            </div>
            <div class="feature-card" onclick="openLuckyNumberModal()">
                <div class="feature-icon">🎰</div>
                <div class="feature-title">幸运数字</div>
                <div class="feature-desc">生成你的专属幸运数字</div>
            </div>
            <div class="feature-card" onclick="openCoinModal()">
                <div class="feature-icon">🪙</div>
                <div class="feature-title">抛硬币决策</div>
                <div class="feature-desc">让命运帮你做选择</div>
            </div>
            <div class="feature-card" onclick="openTarotModal()">
                <div class="feature-icon">🃏</div>
                <div class="feature-title">塔罗占卜</div>
                <div class="feature-desc">抽取塔罗牌指引方向</div>
            </div>
            <div class="feature-card" onclick="openEnergyModal()">
                <div class="feature-icon">⚡</div>
                <div class="feature-title">能量充能</div>
                <div class="feature-desc">为自己注入正能量</div>
            </div>
            <div class="feature-card" onclick="openWishModal()">
                <div class="feature-icon">🌠</div>
                <div class="feature-title">许愿池</div>
                <div class="feature-desc">写下愿望，让它成真</div>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-item"><span>今日好运值:</span><span class="stat-value" id="luckScore">0</span></div>
            <div class="stat-item"><span>累计喷洒次数:</span><span class="stat-value" id="sprayCount">0</span></div>
            <div class="stat-item"><span>收集的祝福:</span><span class="stat-value" id="blessingCount">0</span></div>
        </div>
        <footer>小贴士：添加到主屏幕，随手喷一喷，心情更好～</footer>
    </div>

    <div class="blessing-text" id="blessingText"></div>

    <!-- 运势抽签Modal -->
    <div class="modal" id="fortuneModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('fortuneModal')">×</span>
            <div class="modal-title">🔮 今日运势</div>
            <div class="fortune-card" id="fortuneCard" style="display:none;">
                <div class="fortune-result" id="fortuneEmoji"></div>
                <div class="fortune-text" id="fortuneLevel"></div>
                <div class="fortune-detail" id="fortuneDetail"></div>
            </div>
            <button class="draw-button" onclick="drawFortune()">抽取运势</button>
        </div>
    </div>

    <!-- 幸运数字Modal -->
    <div class="modal" id="luckyNumberModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('luckyNumberModal')">×</span>
            <div class="modal-title">🎰 幸运数字</div>
            <div class="lucky-number-display" id="luckyNumbers"></div>
            <button class="draw-button" onclick="generateLuckyNumbers()">生成幸运数字</button>
        </div>
    </div>

    <!-- 抛硬币Modal -->
    <div class="modal" id="coinModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('coinModal')">×</span>
            <div class="modal-title">🪙 抛硬币决策</div>
            <div class="coins-container"><div class="coin" onclick="flipCoin(this)">🪙</div></div>
            <div class="fortune-text" id="coinResult" style="margin-top:20px;"></div>
            <div class="fortune-detail">点击硬币进行抛掷</div>
        </div>
    </div>

    <!-- 塔罗牌Modal -->
    <div class="modal" id="tarotModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('tarotModal')">×</span>
            <div class="modal-title">🃏 塔罗占卜</div>
            <div class="tarot-cards" id="tarotCards"></div>
            <div class="fortune-card" id="tarotResult" style="display:none; margin-top:20px;">
                <div class="fortune-result" id="tarotEmoji"></div>
                <div class="fortune-text" id="tarotTitle"></div>
                <div class="fortune-detail" id="tarotDetail"></div>
            </div>
        </div>
    </div>

    <!-- 能量充能Modal -->
    <div class="modal" id="energyModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('energyModal')">×</span>
            <div class="modal-title">⚡ 能量充能</div>
            <div class="energy-bar"><div class="energy-fill" id="energyFill" style="width:0%">0%</div></div>
            <button class="draw-button" onclick="chargeEnergy()">开始充能</button>
            <div class="fortune-detail" style="margin-top:20px;">点击按钮为自己注入满满的正能量！</div>
        </div>
    </div>

    <!-- 许愿池Modal -->
    <div class="modal" id="wishModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('wishModal')">×</span>
            <div class="modal-title">🌠 许愿池</div>
            <textarea id="wishText" style="width:100%; height:120px; border-radius:15px; padding:15px; font-size:16px; border:2px solid rgba(255,255,255,.3); background:rgba(255,255,255,.2); color:#fff; resize:none;" placeholder="写下你的愿望..."></textarea>
            <button class="draw-button" onclick="makeWish()" style="margin-top:20px;">投入许愿池</button>
            <div id="wishResult" style="margin-top:20px; color:#fff; font-size:18px;"></div>
        </div>
    </div>

    <script>
        // ===== 数据与文案 =====
        const blessings = [
            "今天一定会超级顺利！✨","好运正在靠近你 💫","你值得被温柔对待 💕","幸福会在不经意间降临 🌸","所有美好都会如期而至 🌈","今天的你闪闪发光 ⭐","愿你被世界温柔以待 🌺","好事即将发生 🎉","你的笑容会带来好运 😊","今天是特别幸运的一天 🍀","心想事成，万事如意 🎊","美好的事情正在路上 🦋","你会收到意外的惊喜 🎁","今天遇到的都是好人 💖","运气爆棚的一天开始了 🌟","所有难题都会迎刃而解 💪","今天的你超级可爱 🌷","好运会眷顾善良的你 🕊️","幸运女神在对你微笑 😇","今天做什么都会很顺利 🎈"
        ];
        const fortuneData = [
            { level:"大吉", emoji:"🌟", detail:"今天运气爆棚！做什么都会特别顺利，是实现愿望的好日子！" },
            { level:"中吉", emoji:"✨", detail:"运势不错，会有小惊喜出现，保持积极心态会更好！" },
            { level:"小吉", emoji:"🍀", detail:"平稳的一天，踏实做事会有好结果，适合稳步前进。" },
            { level:"吉", emoji:"💫", detail:"整体顺利，偶尔会有小波折，但最终都能化解。" },
            { level:"半吉", emoji:"🌈", detail:"运势平平，保持平常心，不要冒险尝试新事物。" },
            { level:"末吉", emoji:"🌸", detail:"需要多加小心，但只要谨慎行事就没问题。" }
        ];
        const tarotData = [
            { name:"太阳", emoji:"☀️", detail:"象征成功、喜悦和活力，一切都在向好的方向发展！" },
            { name:"星星", emoji:"⭐", detail:"带来希望和灵感，你的愿望会逐步实现。" },
            { name:"月亮", emoji:"🌙", detail:"代表直觉与梦想，相信内心的感受会带你走向正确道路。" },
            { name:"世界", emoji:"🌍", detail:"完成与圆满，你即将达成一个重要的目标！" },
            { name:"恋人", emoji:"💕", detail:"象征爱情与选择，会有美好的感情体验。" },
            { name:"力量", emoji:"💪", detail:"代表勇气和决心，你有能力克服任何困难！" }
        ];
        const particles = [ ['✨','⭐','💫','🌟'], ['🌸','🌺','🌷','🌹','🏵️'], ['💖','💕','💗','💝'], ['🦋','🐝','🌈','☀️'] ];

        // ===== 全局状态（带本地持久化） =====
        let currentParticleSet = 0;
        const STATS_KEY = 'luckyAppStats_v1';
        let stats = { luckScore: 0, sprayCount: 0, blessingCount: 0, wishes: [] };
        function loadStats(){ try{ const s = JSON.parse(localStorage.getItem(STATS_KEY)); if(s){ stats = Object.assign(stats, s); } }catch(e){} updateStatsDisplay(); }
        function saveStats(){ localStorage.setItem(STATS_KEY, JSON.stringify(stats)); }
        function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }
        function updateStats(type, delta=0){
            if(type==='spray'){ stats.sprayCount += 1; stats.luckScore = clamp(stats.luckScore + 5, 0, 999); }
            if(type==='blessing'){ stats.blessingCount += 1; stats.luckScore = clamp(stats.luckScore + 2, 0, 999); }
            if(type==='luck'){ stats.luckScore = clamp(stats.luckScore + delta, 0, 999); }
            updateStatsDisplay(); saveStats();
        }
        function updateStatsDisplay(){
            document.getElementById('luckScore').textContent = stats.luckScore;
            document.getElementById('sprayCount').textContent = stats.sprayCount;
            document.getElementById('blessingCount').textContent = stats.blessingCount;
        }

        // ===== 音效与特效 =====
        function playSound(freq=800){
            const ctx = new (window.AudioContext||window.webkitAudioContext)();
            const osc = ctx.createOscillator(); const gain = ctx.createGain();
            osc.connect(gain); gain.connect(ctx.destination);
            osc.frequency.value = freq; osc.type = 'sine';
            gain.gain.setValueAtTime(0.3, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.5);
        }
        function createParticles(x,y){
            const set = particles[currentParticleSet]; const N = 30;
            for(let i=0;i<N;i++){
                const el = document.createElement('div'); el.className='particle'; el.textContent = set[Math.floor(Math.random()*set.length)];
                const ang = (Math.PI*2*i)/N; const dist = 100 + Math.random()*200; const tx = Math.cos(ang)*dist; const ty = Math.sin(ang)*dist;
                el.style.left = x+'px'; el.style.top = y+'px'; el.style.setProperty('--tx', tx+'px'); el.style.setProperty('--ty', ty+'px');
                document.body.appendChild(el); setTimeout(()=>el.remove(), 2000);
            }
            currentParticleSet = (currentParticleSet + 1) % particles.length;
        }
        function showBlessing(){
            const msg = blessings[Math.floor(Math.random()*blessings.length)];
            const box = document.getElementById('blessingText');
            box.textContent = msg; box.classList.remove('show'); void box.offsetWidth; box.classList.add('show');
            updateStats('blessing');
        }
        function triggerFlash(){ const f=document.getElementById('flashOverlay'); f.classList.remove('active'); void f.offsetWidth; f.classList.add('active'); }

        // ===== 主按钮：喷洒好运 =====
        function sprayLuck(){
            const fairy = document.getElementById('fairy');
            fairy.classList.add('spraying'); setTimeout(()=>fairy.classList.remove('spraying'), 500);
            const r = fairy.getBoundingClientRect(); const x = r.left + r.width/2; const y = r.top + r.height/2;
            createParticles(x,y); playSound(); triggerFlash(); setTimeout(showBlessing, 300); updateStats('spray');
        }
        document.getElementById('sprayBtn').addEventListener('click', sprayLuck);
        document.getElementById('fairy').addEventListener('click', sprayLuck);

        // ===== 通用 Modal =====
        function openModal(id){ document.getElementById(id).classList.add('active'); }
        function closeModal(id){ document.getElementById(id).classList.remove('active'); }

        // ===== 今日运势 =====
        function openFortuneModal(){ openModal('fortuneModal'); document.getElementById('fortuneCard').style.display='none'; }
        function drawFortune(){
            const f = fortuneData[Math.floor(Math.random()*fortuneData.length)];
            document.getElementById('fortuneEmoji').textContent = f.emoji;
            document.getElementById('fortuneLevel').textContent = f.level;
            document.getElementById('fortuneDetail').textContent = f.detail;
            document.getElementById('fortuneCard').style.display='block';
            playSound(1000);
            updateStats('luck', 20);
        }

        // ===== 幸运数字 =====
        function openLuckyNumberModal(){ openModal('luckyNumberModal'); document.getElementById('luckyNumbers').innerHTML=''; }
        function generateLuckyNumbers(){
            const box = document.getElementById('luckyNumbers'); box.innerHTML='';
            const set = new Set();
            while(set.size < 6){ set.add(1 + Math.floor(Math.random()*49)); }
            const arr = Array.from(set).sort((a,b)=>a-b);
            arr.forEach(n=>{ const d=document.createElement('div'); d.className='lucky-number'; d.textContent=n; box.appendChild(d); });
            const bonus = Math.floor(arr.reduce((a,b)=>a+b,0) % 15); // 小小加成
            updateStats('luck', 5 + bonus%6);
            playSound(1100);
        }

        // ===== 抛硬币 =====
        function openCoinModal(){ openModal('coinModal'); document.getElementById('coinResult').textContent=''; }
        function flipCoin(el){
            el.classList.add('flipping');
            setTimeout(()=>{
                el.classList.remove('flipping');
                const heads = Math.random() < 0.5;
                const text = heads ? '正面：去做！✅' : '反面：再想想～ 🤔';
                document.getElementById('coinResult').textContent = text;
                updateStats('luck', heads ? 10 : 5);
                playSound(heads?1200:700);
            }, 1000);
        }

        // ===== 塔罗占卜 =====
        function openTarotModal(){
            openModal('tarotModal');
            const wrap = document.getElementById('tarotCards');
            wrap.innerHTML='';
            document.getElementById('tarotResult').style.display='none';
            // 生成 3 张背面卡
            for(let i=0;i<3;i++){
                const c = document.createElement('div'); c.className='tarot-card'; c.textContent='🔮';
                c.addEventListener('click', ()=> revealTarot(c, wrap));
                wrap.appendChild(c);
            }
        }
        function revealTarot(card, wrap){
            // 禁止重复抽
            Array.from(wrap.children).forEach(n=> n.style.pointerEvents='none');
            card.classList.add('flipped');
            setTimeout(()=>{
                const t = tarotData[Math.floor(Math.random()*tarotData.length)];
                const reversed = Math.random() < 0.5; // 是否逆位
                document.getElementById('tarotEmoji').textContent = t.emoji;
                document.getElementById('tarotTitle').textContent = t.name + (reversed ? '（逆位）' : '');
                document.getElementById('tarotDetail').textContent = reversed ? (`逆位提示：放慢脚步，梳理情绪再行动。— ${t.detail}`) : t.detail;
                document.getElementById('tarotResult').style.display='block';
                updateStats('luck', reversed ? 5 : 12);
                playSound(reversed?650:1050);
            }, 300);
        }

        // ===== 能量充能 =====
        function openEnergyModal(){ openModal('energyModal'); const f=document.getElementById('energyFill'); f.style.width='0%'; f.textContent='0%'; }
        function chargeEnergy(){
            const f = document.getElementById('energyFill');
            let cur = 0; const target = 70 + Math.floor(Math.random()*31); // 70~100
            const id = setInterval(()=>{
                cur = Math.min(target, cur + 5 + Math.floor(Math.random()*10));
                f.style.width = cur + '%'; f.textContent = cur + '%';
                if(cur >= target){ clearInterval(id); playSound(1200); updateStats('luck', Math.round(target/5)); }
            }, 120);
        }

        // ===== 许愿池 =====
        function openWishModal(){ openModal('wishModal'); document.getElementById('wishText').value=''; document.getElementById('wishResult').textContent=''; }
        function makeWish(){
            const txt = document.getElementById('wishText').value.trim();
            const r = document.getElementById('wishResult');
            if(!txt){ r.textContent='写点什么吧～（愿望不能为空）'; return; }
            stats.wishes.push({ text: txt, time: new Date().toISOString() }); saveStats();
            r.textContent = '已投入许愿池！愿望正在宇宙排队实现中 ✨';
            // 触发喜悦粒子
            const cx = window.innerWidth/2, cy = window.innerHeight/2; createParticles(cx, cy); playSound(1300);
            updateStats('luck', 15);
        }

        // ===== 初始化 =====
        document.addEventListener('DOMContentLoaded', loadStats);
    </script>
</body>
</html>
